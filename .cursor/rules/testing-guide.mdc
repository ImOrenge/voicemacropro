---
description: 
globs: 
alwaysApply: false
---
# í…ŒìŠ¤íŒ… ë° ë””ë²„ê¹… ê°€ì´ë“œ

## ğŸ§ª í…ŒìŠ¤íŠ¸ êµ¬ì¡° ê°œìš”
VoiceMacro Proì˜ í…ŒìŠ¤íŠ¸ëŠ” ë°±ì—”ë“œ Python í…ŒìŠ¤íŠ¸ì™€ í”„ë¡ íŠ¸ì—”ë“œ C# í†µí•© í…ŒìŠ¤íŠ¸ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

## ğŸ Python ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
backend/tests/
â”œâ”€â”€ test_api_response.py          # API ì‘ë‹µ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_api_validation.py        # API ìœ íš¨ì„± ê²€ì‚¬ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_basic_voice.py           # ê¸°ë³¸ ìŒì„± ì¸ì‹ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_complete_pipeline.py     # ì „ì²´ íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_csharp_api_call.py       # C# ì—°ë™ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_interaction.py           # ìƒí˜¸ì‘ìš© í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_json_mapping.py          # JSON ë§¤í•‘ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_macro_matching.py        # ë§¤í¬ë¡œ ë§¤ì¹­ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_microphone_api.py        # ë§ˆì´í¬ API í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_microphone_detection.py  # ë§ˆì´í¬ ê°ì§€ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_msl_complete.py          # MSL ì™„ì „ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_msl_specific.py          # MSL íŠ¹ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_simple.py                # ê°„ë‹¨í•œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_specific_script.py       # íŠ¹ì • ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_voice_analysis.py        # ìŒì„± ë¶„ì„ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ test_voice_recording.py       # ìŒì„± ë…¹ìŒ í…ŒìŠ¤íŠ¸
â””â”€â”€ test_working_msl.py           # MSL ë™ì‘ í…ŒìŠ¤íŠ¸
```

### ì£¼ìš” í…ŒìŠ¤íŠ¸ ì¹´í…Œê³ ë¦¬

#### 1. MSL (Macro Scripting Language) í…ŒìŠ¤íŠ¸
- **ì™„ì „ í…ŒìŠ¤íŠ¸**: [backend/tests/test_msl_complete.py](mdc:backend/tests/test_msl_complete.py)
- **íŠ¹ì • ê¸°ëŠ¥**: [backend/tests/test_msl_specific.py](mdc:backend/tests/test_msl_specific.py)
- **ë™ì‘ í™•ì¸**: [backend/tests/test_working_msl.py](mdc:backend/tests/test_working_msl.py)

```python
# MSL í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ
def test_msl_basic_sequence():
    """ê¸°ë³¸ ì‹œí€€ìŠ¤ íŒŒì‹± í…ŒìŠ¤íŠ¸"""
    parser = MSLParser()
    ast = parser.parse("W,A,S,D")
    assert ast is not None
    assert len(ast.children) == 4

def test_msl_timing_control():
    """íƒ€ì´ë° ì œì–´ í…ŒìŠ¤íŠ¸"""
    parser = MSLParser()
    ast = parser.parse("W(500)A")
    # 500ms ë”œë ˆì´ ê²€ì¦
```

#### 2. ìŒì„± ì¸ì‹ í…ŒìŠ¤íŠ¸
- **ê¸°ë³¸ ìŒì„±**: [backend/tests/test_basic_voice.py](mdc:backend/tests/test_basic_voice.py)
- **ìŒì„± ë¶„ì„**: [backend/tests/test_voice_analysis.py](mdc:backend/tests/test_voice_analysis.py)
- **ìŒì„± ë…¹ìŒ**: [backend/tests/test_voice_recording.py](mdc:backend/tests/test_voice_recording.py)

#### 3. API í…ŒìŠ¤íŠ¸
- **API ì‘ë‹µ**: [backend/tests/test_api_response.py](mdc:backend/tests/test_api_response.py)
- **API ìœ íš¨ì„±**: [backend/tests/test_api_validation.py](mdc:backend/tests/test_api_validation.py)
- **C# ì—°ë™**: [backend/tests/test_csharp_api_call.py](mdc:backend/tests/test_csharp_api_call.py)

#### 4. ë§¤í¬ë¡œ ë§¤ì¹­ í…ŒìŠ¤íŠ¸
- **ë§¤í¬ë¡œ ë§¤ì¹­**: [backend/tests/test_macro_matching.py](mdc:backend/tests/test_macro_matching.py)
- **JSON ë§¤í•‘**: [backend/tests/test_json_mapping.py](mdc:backend/tests/test_json_mapping.py)

## ğŸ”§ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•

### Python í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
py -m pytest backend/tests/

# íŠ¹ì • í…ŒìŠ¤íŠ¸ íŒŒì¼ ì‹¤í–‰
py -m pytest backend/tests/test_msl_complete.py

# ìƒì„¸ ì¶œë ¥ìœ¼ë¡œ ì‹¤í–‰
py -m pytest backend/tests/ -v

# íŠ¹ì • í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì‹¤í–‰
py -m pytest backend/tests/test_msl_complete.py::test_basic_sequence
```

### MSL íŒŒì„œ ê°œë³„ í…ŒìŠ¤íŠ¸
```bash
# MSL íŒŒì„œ ì§ì ‘ í…ŒìŠ¤íŠ¸
cd backend/parsers
py msl_parser.py

# MSL ì¸í„°í”„ë¦¬í„° í…ŒìŠ¤íŠ¸  
py msl_interpreter.py
```

## ğŸ” ë””ë²„ê¹… ê°€ì´ë“œ

### 1. MSL íŒŒì„œ ë””ë²„ê¹…

#### íŒŒì‹± ë¬¸ì œ í•´ê²°
```python
# ë””ë²„ê¹…ìš© íŒŒì„œ í…ŒìŠ¤íŠ¸
from backend.parsers.msl_parser import MSLParser

def debug_parse(script):
    parser = MSLParser()
    try:
        ast = parser.parse(script)
        print(f"íŒŒì‹± ì„±ê³µ: {ast}")
        return ast
    except Exception as e:
        print(f"íŒŒì‹± ì‹¤íŒ¨: {e}")
        return None

# ë¬¸ì œê°€ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸
debug_parse("~CapsLock,(W,A,S,D),~CapsLock")
```

#### í† í°í™” ë””ë²„ê¹…
```python
from backend.parsers.msl_lexer import MSLLexer

def debug_tokenize(script):
    lexer = MSLLexer()
    tokens = lexer.tokenize(script)
    for token in tokens:
        print(f"í† í°: {token.type} = '{token.value}'")

debug_tokenize("W,A,S,D")
```

### 2. ìŒì„± ì¸ì‹ ë””ë²„ê¹…

#### ë§ˆì´í¬ ë¬¸ì œ í•´ê²°
```python
# ë§ˆì´í¬ ê°ì§€ í…ŒìŠ¤íŠ¸
py backend/tests/test_microphone_detection.py

# ë§ˆì´í¬ API í…ŒìŠ¤íŠ¸
py backend/tests/test_microphone_api.py
```

#### Whisper ì„œë¹„ìŠ¤ ë””ë²„ê¹…
```python
from backend.services.whisper_service import WhisperService

def debug_whisper():
    service = WhisperService()
    # í…ŒìŠ¤íŠ¸ ì˜¤ë””ì˜¤ íŒŒì¼ë¡œ ì¸ì‹ í…ŒìŠ¤íŠ¸
    result = service.transcribe("test_audio.wav")
    print(f"ì¸ì‹ ê²°ê³¼: {result}")
```

### 3. API ì—°ë™ ë””ë²„ê¹…

#### ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸
```python
# API ì„œë²„ ìƒíƒœ í™•ì¸
import requests

def test_server_connection():
    try:
        response = requests.get("http://127.0.0.1:5000/api/health")
        print(f"ì„œë²„ ìƒíƒœ: {response.status_code}")
        return response.status_code == 200
    except Exception as e:
        print(f"ì„œë²„ ì—°ê²° ì‹¤íŒ¨: {e}")
        return False
```

#### C# API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
```bash
# C# ìª½ì—ì„œ Python API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
py backend/tests/test_csharp_api_call.py
```

## ğŸš¨ ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°

### 1. MSL íŒŒì„œ ì˜¤ë¥˜

#### ë¬¸ì œ: í† ê¸€(`~`) íŒŒì‹± ì‹¤íŒ¨
```python
# í•´ê²°ë°©ë²•: msl_lexer.pyì—ì„œ í† ê¸€ í† í° ì •ì˜ í™•ì¸
class MSLLexer:
    def __init__(self):
        self.tokens = [
            # ... ê¸°ì¡´ í† í°ë“¤
            ('TILDE', r'~'),  # í† ê¸€ ì—°ì‚°ì ì¶”ê°€
        ]
```

#### ë¬¸ì œ: ë³µì¡í•œ ê·¸ë£¹í™” íŒŒì‹± ì‹¤íŒ¨
```python
# í•´ê²°ë°©ë²•: msl_parser.pyì—ì„œ ê·¸ë£¹ ì²˜ë¦¬ ë¡œì§ ê°•í™”
def parse_group(self):
    if self.current_token.type == 'LPAREN':
        # ê·¸ë£¹ ë‚´ë¶€ íŒŒì‹± ë¡œì§ êµ¬í˜„
        pass
```

### 2. ìŒì„± ì¸ì‹ ì˜¤ë¥˜

#### ë¬¸ì œ: ë§ˆì´í¬ ê¶Œí•œ ê±°ë¶€
```python
# í•´ê²°ë°©ë²•: ë§ˆì´í¬ ê¶Œí•œ í™•ì¸ ë° ìš”ì²­
import pyaudio

def check_microphone_permission():
    try:
        audio = pyaudio.PyAudio()
        # ë§ˆì´í¬ ì¥ì¹˜ ëª©ë¡ í™•ì¸
        for i in range(audio.get_device_count()):
            info = audio.get_device_info_by_index(i)
            if info['maxInputChannels'] > 0:
                print(f"ë§ˆì´í¬ ì¥ì¹˜: {info['name']}")
        audio.terminate()
        return True
    except Exception as e:
        print(f"ë§ˆì´í¬ ê¶Œí•œ ì˜¤ë¥˜: {e}")
        return False
```

#### ë¬¸ì œ: Whisper ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨
```python
# í•´ê²°ë°©ë²•: ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ë° ìºì‹œ í™•ì¸
import whisper

def fix_whisper_model():
    try:
        model = whisper.load_model("base")
        print("Whisper ëª¨ë¸ ë¡œë”© ì„±ê³µ")
        return model
    except Exception as e:
        print(f"ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨: {e}")
        # ëª¨ë¸ ì¬ë‹¤ìš´ë¡œë“œ ë˜ëŠ” ìºì‹œ ì‚­ì œ í•„ìš”
        return None
```

### 3. API ì—°ë™ ì˜¤ë¥˜

#### ë¬¸ì œ: ì„œë²„ ì‹œì‘ ì‹¤íŒ¨
```bash
# í•´ê²°ë°©ë²•: í¬íŠ¸ ì¶©ëŒ í™•ì¸
netstat -ano | findstr 5000

# ë‹¤ë¥¸ í¬íŠ¸ë¡œ ì„œë²„ ì‹œì‘
set PORT=5001
py run_server.py
```

#### ë¬¸ì œ: C# HTTP ìš”ì²­ ì‹¤íŒ¨
```csharp
// í•´ê²°ë°©ë²•: HttpClient ì„¤ì • í™•ì¸
private static readonly HttpClient client = new HttpClient()
{
    Timeout = TimeSpan.FromSeconds(30),
    BaseAddress = new Uri("http://127.0.0.1:5000/")
};
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

### í˜„ì¬ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ìƒíƒœ
- âœ… **MSL ê¸°ë³¸ íŒŒì‹±**: 90% ì»¤ë²„ë¦¬ì§€
- âœ… **API ì—”ë“œí¬ì¸íŠ¸**: 85% ì»¤ë²„ë¦¬ì§€
- âš ï¸ **ìŒì„± ì¸ì‹**: 70% ì»¤ë²„ë¦¬ì§€ (í•˜ë“œì›¨ì–´ ì˜ì¡´ì„±)
- âš ï¸ **ë§¤í¬ë¡œ ì‹¤í–‰**: 60% ì»¤ë²„ë¦¬ì§€ (ì‹œìŠ¤í…œ ê¶Œí•œ í•„ìš”)
- âŒ **ë³µì¡í•œ MSL êµ¬ë¬¸**: 40% ì»¤ë²„ë¦¬ì§€ (ê°œë°œ ì¤‘)

### í…ŒìŠ¤íŠ¸ ìš°ì„ ìˆœìœ„
1. MSL í† ê¸€(`~`) ì—°ì‚°ì ì™„ì„±
2. ìŒì„± ì¸ì‹ ì •í™•ë„ í–¥ìƒ
3. API ì˜¤ë¥˜ ì²˜ë¦¬ ê°•í™”
4. ë§¤í¬ë¡œ ì‹¤í–‰ ì•ˆì •ì„± ê°œì„ 

## ğŸ› ï¸ ê°œë°œ í™˜ê²½ ì„¤ì •

### í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì„±
```bash
# ê°€ìƒí™˜ê²½ ìƒì„± (ê¶Œì¥)
python -m venv test_env
test_env\Scripts\activate

# í…ŒìŠ¤íŠ¸ ì˜ì¡´ì„± ì„¤ì¹˜
pip install pytest pytest-cov pytest-mock

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ ì„œë²„ ì‹œì‘
py run_server.py &
```

### ë””ë²„ê·¸ ëª¨ë“œ ì„¤ì •
```python
# backend/utils/config.py
DEBUG_MODE = True
LOG_LEVEL = "DEBUG"
ENABLE_DETAILED_LOGGING = True
```

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ
- **ì „ì²´ í…ŒìŠ¤íŠ¸ ì „ëµ**: [PRD_ê²Œì„AIìŒì„±ë§¤í¬ë¡œ.md](mdc:PRD_ê²Œì„AIìŒì„±ë§¤í¬ë¡œ.md) ì„¹ì…˜ 8
- **MSL íŒŒì„œ ëª…ì„¸**: [msl-guide.mdc](mdc:.cursor/rules/msl-guide.mdc)
- **API ë¬¸ì„œ**: [api-integration.mdc](mdc:.cursor/rules/api-integration.mdc)

